<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @page {
            size: landscape;
            margin: 0.3in;
            
            @bottom-center {
                content: "Page " counter(page) " of " counter(pages);
                font-family: sans-serif;
                font-weight: normal;
                font-size: 7pt;
                color: #555;
            }

            @top-right {
              content: "Transmittal No: <?= transmittalNo ?>";
              font-family: sans-serif;
              font-weight: normal;
              font-size: 7pt;
              color: #555;
              margin-top: 0.7in; /* This line is added to push the text down from the top edge */
          }
        }

        body { font-family: sans-serif; font-size: 8pt; line-height: 1.1; }
        .container { max-width: 100% !important; padding: 0 !important; }
        .fs-5 { font-size: 1rem !important; }

        .form-header { 
          display: flex; 
          align-items: center;
          margin-bottom: 0.5rem; 
          border-bottom: 1px solid #dee2e6; 
          padding-bottom: 0.5rem; 
        }
        
        .header-logo {
          min-width: 60px;
          position: relative;
          margin-right: 5px;
          top: 7px;
          left: 0px; 
        }
        
        .header-text { 
          text-align: left; 
        }
        
        .header-text h2 { font-weight: bold; margin: 0; font-size: 1.4rem; }
        .header-text p { margin: 0; font-size: 7pt; color: #6c757d; }
        
        .section-box {
            border: 1px solid #ccc !important;
            padding: 4px;
            margin-bottom: 0.5rem;
            border-radius: 0.25rem;
        }

        .section-box .fs-5 {
            font-size: 9pt !important;
        }
        
        .section-box .row {
            margin-right: 0;
            margin-left: 0;
            margin-top: 1px !important;
        }

        .section-box .row > * {
            padding-left: 2px;
            padding-right: 2px;
        }
        
        .section-box .col-9 {
            min-width: 0;
        }

        .label {
            font-weight: bold;
            color: #555;
            font-size: 7pt;
        }

        .value {
            border-bottom: 1px solid #eee;
            padding: 0 2px;
            min-height: 13px;
            font-size: 7pt;
            word-wrap: break-word;
            overflow-wrap: break-word; 
        }

        .table { border-collapse: collapse; width: 100%; table-layout: fixed; margin-top: 0.5rem; }
        
        .table th, .table td { 
            border: 1px solid #6c757d !important; 
            padding: 2px; 
            text-align: left; 
            word-wrap: break-word; 
        }
        
        .table th { 
            background-color: #f2f2f2; 
            font-weight: bold; 
            font-size: 6pt;
        }

        .table td {
            font-size: 7pt;
        }

        .nothing-follows-marker { text-align: center; font-style: italic; margin-top: 0.5rem; font-weight: bold; font-size: 8pt; }
        .row > * { padding-right: 4px; padding-left: 4px; }
        .row { margin-right: -4px; margin-left: -4px; }
    </style>
  </head>
  <body>
    <div class="container">
        <div class="form-header">
            <div class="header-logo">
                <?!= logoHtml ?>
            </div>
            <div class="header-text">
                <h2><?= formTitle ?></h2>
                <p><?= addressLine ?></p>
                <p><?= phoneLine ?></p>
            </div>
        </div>

        <table style="width: 100%; border-collapse: separate; border-spacing: 15px 0;">
            <tbody>
                <tr style="vertical-align: top;">
                    <!-- MODIFIED LINE BELOW -->
                    <td style="width: 50%; padding: 0;">
                        <div class="section-box" style="height: 100%;">
                            <strong class="fs-5">FROM:</strong>
                            <div class="row mt-1">
                                <div class="col-3 label">Name:</div>
                                <div class="col-9 value"><?= fromName ?></div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-3 label">Dept:</div>
                                <div class="col-9 value"><?= fromDepartment ?></div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-3 label">Sign:</div>
                                <div class="col-9 value"></div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-3 label">Date:</div>
                                <div class="col-9 value"><?= dateTransmitted ?></div>
                            </div>
                        </div>
                    </td>
                    <!-- MODIFIED LINE BELOW -->
                    <td style="width: 50%; padding: 0;">
                        <div class="section-box" style="height: 100%;">
                            <strong class="fs-5">TO:</strong>
                            <div class="row mt-1">
                                <div class="col-3 label">Name:</div>
                                <div class="col-9 value"><?= toName ?></div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-3 label">Dept:</div>
                                <div class="col-9 value"><?= toDepartment ?></div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-3 label">Address:</div>
                                <div class="col-9 value"><?= toAddress ?></div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-3 label">Sign:</div>
                                <div class="col-9 value"></div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-3 label">Date:</div>
                                <div class="col-9 value"></div>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <?
          const showDocDetails = items.some(item => item.docDetails);
          const showRfpPef = items.some(item => item.rfpPef);
          const showSupplier = items.some(item => item.supplier);
          const showPayorCompany = items.some(item => item.payorCompany);
          const showProperty = items.some(item => item.property);
          const showLocation = items.some(item => item.location);
          const showSector = items.some(item => item.sector);
          const showServiceType = items.some(item => item.serviceType);
          const showPeriodCovered = items.some(item => item.periodCovered);
          const showParticulars = items.some(item => item.particulars);
          const showRfpAmount = items.some(item => item.rfpAmount);
        ?>

        <table class="table">
            <thead>
                <tr>
                    <th style="width: 3%; text-align: center;">#</th>
                    <? if (showDocDetails) { ?><th>DOCUMENT TRANSMITTED/ DETAILS</th><? } ?>
                    <? if (showRfpPef) { ?><th>RFP/ PEF #</th><? } ?>
                    <? if (showSupplier) { ?><th style="width: 15%;">SUPPLIER/ VENDOR/ AGENCY</th><? } ?>
                    <? if (showPayorCompany) { ?><th>PAYOR COMPANY</th><? } ?>
                    <? if (showProperty) { ?><th>PROPERTY</th><? } ?>
                    <? if (showLocation) { ?><th>LOCATION</th><? } ?>
                    <? if (showSector) { ?><th>SECTOR</th><? } ?>
                    <? if (showServiceType) { ?><th>TYPE OF SERVICE</th><? } ?>
                    <? if (showPeriodCovered) { ?><th>PERIOD COVERED</th><? } ?>
                    <? if (showParticulars) { ?><th>PARTICULARS</th><? } ?>
                    <? if (showRfpAmount) { ?><th>RFP/ PEF AMOUNT</th><? } ?>
                </tr>
            </thead>
            <tbody>
                <!-- ============================================= -->
                <!-- NEW SCRIPTLET WITH FORMATTING FUNCTION ADDED HERE -->
                <!-- ============================================= -->
                <?
                  function formatNumberInTemplate(value) {
                    const num = parseFloat(value);
                    if (isNaN(num)) {
                      return ''; // Return an empty string for non-numeric values
                    }
                    
                    // Convert number to string with 2 decimal places
                    const parts = num.toFixed(2).split('.');
                    
                    // Add commas to the integer part using a regular expression
                    parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                    
                    // Join the integer and decimal parts back together
                    return parts.join('.');
                  }
                ?>
                
                <? for(let i = 0; i < items.length; i++) { ?>
                <tr>
                    <td style="text-align: center;"><?= i + 1 ?></td>
                    <? if (showDocDetails) { ?><td><?= items[i].docDetails ?></td><? } ?>
                    <? if (showRfpPef) { ?><td><?= items[i].rfpPef ?></td><? } ?>
                    <? if (showSupplier) { ?><td><?= items[i].supplier ?></td><? } ?>
                    <? if (showPayorCompany) { ?><td><?= items[i].payorCompany ?></td><? } ?>
                    <? if (showProperty) { ?><td><?= items[i].property ?></td><? } ?>
                    <? if (showLocation) { ?><td><?= items[i].location ?></td><? } ?>
                    <? if (showSector) { ?><td><?= items[i].sector ?></td><? } ?>
                    <? if (showServiceType) { ?><td><?= items[i].serviceType ?></td><? } ?>
                    <? if (showPeriodCovered) { ?><td><?= items[i].periodCovered ?></td><? } ?>
                    <? if (showParticulars) { ?><td><?= items[i].particulars ?></td><? } ?>
                    
                    <!-- ============================================= -->
                    <!-- MODIFIED RFP AMOUNT LINE IS HERE              -->
                    <!-- ============================================= -->
                    <? if (showRfpAmount) { ?><td style="text-align: right;"><?= formatNumberInTemplate(items[i].rfpAmount) ?></td><? } ?>
                    
                </tr>
                <? } ?>
            </tbody>
        </table>

        <p class="nothing-follows-marker">--- NOTHING FOLLOWS ---</p>
    </div>
  </body>
</html>
